<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css">
    <link rel="stylesheet" href="button.css" type="text/css">
    <script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
</head>
<body>
<!--<a href="#" class="button button-circle">Silver Circle</a>-->
<!--<a href="#" class="button button-circle button-primary">Blue Circle</a>-->
<!--<a href="#" class="button button-circle button-action">Green Circle</a>-->
<!--<a href="#" class="button button-circle button-highlight">Orange Circle</a>-->
<!--<a href="#" class="button button-circle button-caution">Red Circle</a>-->
<!--<a href="#" class="button button-circle button-royal">Purple Circle</a>-->

<div id="container"></div>

<script>
    function standartLog(stage) {
        switch (stage.status) {
            case "Completed":
                $$("log").setValue(stage.log);
                break;
            case "Error":
                $$("log").setValue(stage.log + "\n" + "\n" + "\n" + "Errors:\n" + stage.errors);
                break;
            case "In Process":
                $$("log").setValue(stage.log);
        }
    }
    var form1 = [
        {type: "header", template: "OCR Helper"},
        {
            margin: 5, cols: [
                {
                    rows:[
                        {view: "datatable",
                        scroll: false,
                        id: "dtable",
                        resizeColumn: true,
                        css: "my-dtable",
                        on: {
                            'onItemClick': function (id) {
                            var item = this.getItem(id);
                            var stage = item.stages.find(function (element) {return element.name === id.column});
                            switch (id.column){
                                case "Downloaded":
                                    standartLog(stage);
                                    break;
                                case "Files attached":
                                    standartLog(stage);
                                    break;
                                case "Integrity validated":
                                    standartLog(stage);
                                    if(stage.status === "Error"){
                                        webix.message("Please, open Capture and fix some problems")
                                    }
                                    break;
                                case "Current advances checked":
                                    standartLog(stage);
                                    if(stage.status === "Error"){
                                        $$("Current Advances").show();
                                    }
                                    break;
                                case "CBC pulled":
                                    standartLog(stage);
                                    break;
                                case "Completed":
                                    standartLog(stage);
                                    if(stage.status === "Error"){
                                        webix.message("Please, try to export the statement again");
                                    }
                                    break;
                            }
                            }
                        },
                        columns: [
                            {id: "id", header: "id", width: 30},
                            {id: "opportunityName", header: "Opportunity Name", fillspace: true},
                            {id: "Downloaded", header: "Downloaded",adjust:"header", template: function(obj){
                            var Downloaded = obj.stages.find(function(item) {return item.name === "Downloaded"});
                                if(Downloaded && Downloaded.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Downloaded && Downloaded.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Downloaded && Downloaded.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                        }},
                            {id: "Files attached", header: "Attached", adjust:"header",template: function(obj){
                                var Attached = obj.stages.find(function(item) {return item.name === "Files attached"});
                                if(Attached && Attached.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Attached && Attached.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Attached && Attached.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }},
                            {id: "Integrity validated", header: "Validated",adjust:"header",template: function(obj){
                                var Validated = obj.stages.find(function(item) {return item.name === "Integrity validated"});
                                if(Validated && Validated.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Validated && Validated.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Validated && Validated.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }},
                            {id: "Current advances checked", header: "Advances",adjust:"header",template: function(obj){
                                var Advances = obj.stages.find(function(item) {return item.name === "Current advances checked"});
                                if(Advances && Advances.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Advances && Advances.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Advances && Advances.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }},
                            {id: "CBC pulled", header: "CBC",adjust:"header",template: function(obj){
                                var CBC = obj.stages.find(function(item) {return item.name === "CBC pulled"});
                                if(CBC && CBC.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(CBC && CBC.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(CBC && CBC.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }},
                            {id: "Submission validated", header: "Submission",adjust:"header",template: function(obj){
                                var Submission = obj.stages.find(function(item) {return item.name === "Submission validated"});
                                if(Submission && Submission.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Submission && Submission.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Submission && Submission.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }},
                            {id: "Completed", header: "Completed",adjust:"header",template: function(obj){
                                var Completed = obj.stages.find(function(item) {return item.name === "Completed"});
                                if(Completed && Completed.status === "Completed"){return "<a href=\"#\" class=\"button button-circle button-action\">";}
                                if(Completed && Completed.status === "Error"){ return "<a href=\"#\" class=\"button button-circle button-caution\">";}
                                if(Completed && Completed.status === "In Process"){ return "<a href=\"#\" class=\"button button-circle\">";}
                            }}
                        ]},
                        {
                            id:"Current Advances",
                            view: "toolbar",
                            hidden: true,
                            height: 150,
                            elements:[
                                {
                                    id: "ErrorAdvancesList",
                                    view: "list",
                                    on:{
                                        "onItemClick":function(id){
                                            var obj = this.getItem(id);
                                            var stage = obj.stages.find(function(item) {return item.name === "Current advances checked"});
                                            $$("AdvanceEditor").setValue(stage.errors);
                                        }
                                    },
                                    template:function(obj){
                                        var stage = obj.stages.find(function(item) {return item.name === "Current advances checked"});
                                        return stage.errors
                                    }
                                },
                                {rows:[
                                        {
                                            cols:[
                                                {
                                                    id: "AdvanceEditor",
                                                    view: "textarea",
                                                    placeholder: "Write down new MCI"
                                                },
                                                {
                                                    id:"dropDown",
                                                    view:"select",
                                                    options:[
                                                        "Placeholder #1",
                                                        "Placeholder #2",
                                                        "Placeholder #3"
                                                    ],
                                                    width: 120
                                                }
                                                ]
                                        },
                                        {
                                            id: "MCI button",
                                            view: "button",
                                            value: "Assign",
                                            on:{
                                                "onItemClick": function () {
                                                    webix.message("I don't know how to assign new MCI's")
                                                }
                                            }
                                        },
                                        {
                                            id: "Hide button",
                                            view: "button",
                                            value: "Done",
                                            on:{
                                                "onItemClick": function(){
                                                    $$("Current Advances").hide();
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                        ]
                },
                {view: "resizer"},
                {
                    id: "log", view: "textarea", type: "form", value: "Here is log", width: 350, height: 500
                }
            ],
        },
        {view: "button", name: "submit", value: "Export Opportunity",
            on:{
                "onItemClick":function () {
                    webix.message("How do we export, again?")
                }
            }
        }
    ];
    webix.ui({
        view: "form",
        id: "my_form",
        css: "form",
        elements: form1
    });
    webix.ajax().get('data.json', function (t, d) {
        $$('dtable').parse(d.json().opportunities);
        $$('ErrorAdvancesList').parse(d.json().opportunities)
    })

</script>
</body>
</html>